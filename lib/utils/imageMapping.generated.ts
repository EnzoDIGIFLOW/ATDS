/**
 * MAPPING COMPLET des images - G√©n√©r√© le 2025-08-15
 * Syst√®me intelligent avec 120+ produits mapp√©s
 */

export const IMAGE_MAPPING: Record<string, string | null> = {
  // === BOISSONS - Pas d'images de sushi pour les boissons! ===
  "Eau Plate": null,
  "San Pellegrino": null,
  "Oasis": null,
  "Coca Cola": null,
  "Coca Cola Zero": null,
  "Goyave Litchi": null,
  "Th√© Jomo Gingembre": null,
  "Th√© Jomo Mangue": null,
  "Th√© Jomo Passion Citron Vert": null,
  "Th√© Jomo P√™che": null,
  "Desperados Blonde": null,
  "Kirin": null,
  "Asahi": null,
  "Pietra": null,
  
  // === MAKIS PAR 6 ===
  "Cheese": "maki/makis cheese .webp",
  "Concombre, Cheese": "maki/makis concombre cheese .webp",
  "Avocat": "maki/makis avocat amyo .webp",
  "Avocat, Mayo": "maki/makis avocat amyo .webp",
  "Poulet, Cheese": "maki/makis poulet cheese .webp",
  "Poulet Curry": "maki/makis poulet curry .webp",
  "Poulet, Mayonnaise": "maki/makis poulet mayo .webp",
  "Saumon": "maki/makis saumon .webp",
  "Saumon, Cheese": "maki/makis saumon cheese .webp",
  "Thon": "maki/makis thon.webp",
  "Thon, Cheese": "maki/makis thon cheese .webp",
  
  // === CALIFORNIA PAR 6 ===
  "Poulet, Cheese": "california/cali poulet cheese .webp",
  "Saumon Cheese": "california/cali saumon cheese .webp",
  "Poulet Curry": "california/cali poulet curry .webp",
  "Saumon, Avocat": "california/cali saumon avocat .webp",
  "Saumon, Avocat, Tobiko": "california/cali saumon avocat tobiko.webp",
  "Crevette Tempura, Mayo": "california/cali tempura avocat mayo .webp",
  "Saumon, Mangue, Menthe": "california/cali saumon mangue menthe.webp",
  "Gambas, Cheese": "california/cali gambas cheese .webp",
  "Gambas, Cheese, Oignon Frit": "california/cali gambas cheese oignon frit .webp",
  
  // === SASHIMI PAR 6 ===
  "Saumon": "sashimi/sashimi saumon .webp",
  "Thon": "sashimi/sashimi thon.webp",
  "Duo": "sashimi/sashimi duo .webp",
  
  // === SUSHI √Ä L'UNIT√â ===
  "Saumon": "sushi nigiri/sushi saumon.webp",
  "Saumon Cheese": "sushi nigiri/sushi saumon cheese .webp",
  "Saumon Ciboulette": "sushi nigiri/sushi saumon ciboulette .webp",
  "Saumon Mangue": "sushi nigiri/sushi saumon mangue .webp",
  "Saumon Brais√©": "sushi nigiri/sushi saumon brais√©.webp",
  "Saumon Brais√©, Truffe": "sushi nigiri/sushi saumon brais√© truffe.webp",
  "Thon": "sushi nigiri/sushi thon.webp",
  "Thon Brais√©": "sushi nigiri/sushi thon brais√© .webp",
  "Sushis saumon avocat jalapeno": "sushi nigiri/sushis saumon avocat jalapeno.webp",
  
  // === POKE BOWLS ===
  "Poke Bowl N¬∞01": "poke bowl /POKE 1.webp",
  "Poke Bowl N¬∞02": "poke bowl /POKE 2.webp",
  "Poke Bowl N¬∞03": "poke bowl /POKE 3.webp",
  "Poke Bowl N¬∞04": "poke bowl /POKE 4.webp",
  "Poke Bowl N¬∞05": "poke bowl /POKE 5.webp",
  "Poke Bowl N¬∞06": "poke bowl /poke 6.webp",
  "Poke Bowl N¬∞07": "poke bowl /POKE 7.webp",
  "Poke Bowl N¬∞08": "poke bowl /POKE 8.webp",
  "Poke Bowl N¬∞10": "poke bowl /POKE 10.webp",
  "Poke Bowl N¬∞11": "poke bowl /POKE 11.webp",
  "Poke Bowl N¬∞12": "poke bowl /POKE 12.webp",
  
  // === ACCOMPAGNEMENTS ===
  "Riz Vinaigr√©": "accompagnement/riz vinaigre .webp",
  "Salade de Chou": "accompagnement/salade de chou .webp",
  "Salade Edamame": "accompagnement/edamame.webp",
  "Salade Algue Wakame": "accompagnement/wakame .webp",
  "Salade de Chou Accompagn√© de Saumon": "accompagnement/chou saumon.webp",
  "Salade de Chou Accompagn√© de Thon": "accompagnement/chou thon 2.webp",
  
  // === PLATEAUX ===
  "Box Sushi Mix (12 pi√®ces)": "plateaux /Box sushi mix 12pcs .webp",
  "Box Sushi Saumon (10 pi√®ces)": "plateaux /box sushi saumon 10pcs.webp",
  "Plateau California (18 pi√®ces)": "plateaux /box california 18pcs  .webp",
  "Plateau Makis (18 pi√®ces)": "plateaux /box makis 18pcs .webp",
  "Love Box (24 pi√®ces)": "plateaux /love box - Grande.webp",
  "Super Box (14 pi√®ces)": "plateaux /super box .webp",
  "Plateau (60 pi√®ces)": "plateaux /plateau 60 pcs.webp",
  "Plateaux Chaud (26 pi√®ces)": "plateaux /plateau chaud  26 pi√®ces .webp",
  
  // === PLATS CHAUDS ===
  "Soupe Miso Tofu": "soupe miso/soupe .webp",
  "Nem L√©gumes": "plat chaud /nem .webp",
  "Samoussa B≈ìuf": "plat chaud /samoussa .webp",
  "Samoussa Poulet": "plat chaud /samoussa .webp",
  "Gyoza Porc": "plat chaud /Gyoza porc .webp",
  "Gyoza Poulet Curry": "plat chaud /gyoza poulet curry.webp",
  "Gyoza Crevette": "plat chaud /gyoza crevette .webp",
  "Crevettes Tempura": "plat chaud /crevette tempura .webp",
  
  // === FORMULES ===
  "Formule A": "formule du midi /Formule A jpg.webp",
  
  // === BURITOS ===
  "Poulet Caram√©lis√©": "burito/buritos poulet caramelis√© .webp",
  "Poulet Frit Avocat Mayo": "burito/buritos poulet frit avocat chesse.webp",
  "Saumon Avocat Cheese": "burito/buritos saumon avocat cheese .webp",
  
  // === CHIRASHI ===
  "Saumon Avocat": "chirachi/chirashi saumon avocat.webp",
  "Saumon, Thon": "chirachi/chirashi saumo thon avocat cheese oignon frit .webp",
  
  // === CRISPY ===
  "Saumon Cheese": "crispy/crisoy saumon cheese .webp",
  "Poulet Frit Cheddar": "crispy/crisoy poulet frit cheddar oignon frit_.webp",
  "Cheese Saumon Tartare": "crispy/crispy cheese et saumon fa√ßon tartare ciboulette.webp",
  "Saumon Avocat Cheese": "crispy/crispy saumon avocat cheese oignon frit.webp",
  "Saumon Cuit Cheese Fraise": "crispy/crispy saumon cheese fraise_.webp",
  
  // === SPRING ===
  "Saumon": "spring /spring saumon 2.webp",
  "Thon Cuit Cheese": "spring /spring thon cheese .webp",
  "Thon Cuit Mayo": "spring /spring thon mayo .webp",
  "Thon Mangue": "spring /spring thon mangue .webp",
  "Gambas Avocat": "spring /spring gambas avocat .webp",
  "Gambas Cheese": "spring /spring gambas cheese.webp",
  "Poulet Frit Avocat Cheese": "spring /spring poulet frit avoca cheese .webp",
  "Saumon, Cheese, Tobiko": "spring /spring saumo cheese tobiko.webp",
  
  // === ROLL'S ===
  "Avocat Cheese": "roll_s/rolls avocat cheese .webp",
  "Saumon": "roll_s/tolls saumon .webp",
  "Saumon Cheese": "roll_s/rollsa saumon cheese .webp",
  "Concombre Avocat": "roll_s/rolls mangue saumon .webp",
  
  // === FLOCON ===
  "Thon": "flocon/flocon thon .webp",
  
  // === CR√âATION DU CHEF ===
  "L'Italien": "cr√©ation du chef/L_italien 4.webp",
  "California Poulet Frit": "cr√©ation du chef/cali poulet frit guacamole jalap.webp",
  "California Crevette Tempura": "cr√©ation du chef/cali tempura avocat enrobe saumon brais√© .webp",
  "California Poulet Caram√©lis√©": "cr√©ation du chef/california poulet caramelis√© mangue .webp",
  "Flocon Saumon Avocat": "cr√©ation du chef/flocon saumon avocat tobiko menthe .webp",
  "Roll's Avocat Truffe": "cr√©ation du chef/roll_s brais√© truffe  - Grande - Grande.webp",
  "Rolls Saumon Brais√©": "cr√©ation du chef/roll_s avocat sauce spicy.webp",
  "Avocat Mayo": "cr√©ation du chef/roll_s avocat pousse de cress.webp",
  "California Saumon": "cr√©ation du chef/saumon guacamole jalap.webp",
  "Rolls Avocat": "cr√©ation du chef/rolls avocat enrob√© de thon, zeste de kiwi, tobiko.webp",
  
  // === DESSERTS ===
  "Mochi du Jour": "dessert/mochis .webp",
  "Makis Mangue Nutella Coco Rap√©": "dessert/Makis mangue nutella coco rap√© -2.webp",
  
  // === TARTARE ===
  "Tartare Saumon": "tartare/tartare saumon avoca.webp",
  "Tartare Thon, Saumon": "tartare/taratre thon saumon avocat tobiko 2.webp",
  
  // === NOUILLES ===
  "Nouilles Crevettes et L√©gumes": "nouilles/nouilles crevettes_.webp",
  "Nouilles Poulet Teriyaki et L√©gumes": "nouilles/nouille teryaki.webp"
}

// Fonction de recherche intelligente
export function getProductImage(productName: string, category?: string): string | null {
  // Recherche exacte d'abord
  if (IMAGE_MAPPING[productName]) {
    return IMAGE_MAPPING[productName]
  }
  
  // Recherche par mots-cl√©s intelligente
  const normalizedName = productName.toLowerCase().trim()
  const normalizedCategory = (category || '').toLowerCase().trim()
  
  // IMPORTANT: V√©rifier la cat√©gorie d'abord pour √©viter les m√©langes
  // Pour les boissons, retourner null (pas d'image de sushi!)
  if (normalizedCategory.includes('boisson') || normalizedCategory.includes('drink')) {
    return null
  }
  
  // Recherche par correspondances partielles SEULEMENT si la cat√©gorie correspond
  for (const [key, path] of Object.entries(IMAGE_MAPPING)) {
    const normalizedKey = key.toLowerCase()
    
    // V√©rifier que c'est la bonne cat√©gorie avant de matcher
    if (category && path) {
      const imageCategoryGuess = path.split('/')[0].toLowerCase()
      
      // Si on cherche un sushi mais que l'image est un maki, skip
      if (normalizedCategory.includes('sushi') && !normalizedCategory.includes('maki') && imageCategoryGuess.includes('maki')) {
        continue
      }
      // Si on cherche un maki mais que l'image est un sushi, skip
      if (normalizedCategory.includes('maki') && imageCategoryGuess.includes('sushi')) {
        continue
      }
      // Si on cherche un california mais que l'image n'est pas california, skip
      if (normalizedCategory.includes('california') && !imageCategoryGuess.includes('california')) {
        continue
      }
    }
    
    // Correspondance exacte du nom
    if (normalizedName === normalizedKey) {
      return path
    }
    
    // Recherche par mots-cl√©s sp√©cifiques (plus strict)
    const keyWords = normalizedKey.split(/[,\s]+/).filter(w => w.length > 2)
    const nameWords = normalizedName.split(/[,\s]+/).filter(w => w.length > 2)
    
    // Compter les correspondances exactes de mots
    let exactMatchCount = 0
    for (const keyWord of keyWords) {
      for (const nameWord of nameWords) {
        if (keyWord === nameWord) {
          exactMatchCount++
        }
      }
    }
    
    // Si on a au moins 2 mots EXACTS qui correspondent
    if (exactMatchCount >= 2) {
      return path
    }
  }
  
  // Recherche par cat√©gorie avec fallbacks intelligents
  if (category) {
    if (normalizedCategory.includes('sushi') && normalizedName.includes('saumon')) {
      return 'sushi nigiri/sushi saumon.webp'
    }
    if (normalizedCategory.includes('sushi') && normalizedName.includes('thon')) {
      return 'sushi nigiri/sushi thon.webp'
    }
    if (normalizedCategory.includes('maki') && normalizedName.includes('saumon')) {
      return 'maki/makis saumon .webp'
    }
    if (normalizedCategory.includes('maki') && normalizedName.includes('thon')) {
      return 'maki/makis thon.webp'
    }
    if (normalizedCategory.includes('california') && normalizedName.includes('saumon')) {
      return 'california/cali saumon avocat .webp'
    }
    if (normalizedCategory.includes('poke bowl')) {
      const match = normalizedName.match(/n¬∞?(\d+)/)
      if (match) {
        const num = match[1]
        if (['1', '2', '3', '4', '5', '7', '8', '10', '11', '12'].includes(num)) {
          return `poke bowl /POKE ${num}.webp`
        }
        if (num === '6') {
          return 'poke bowl /poke 6.webp'
        }
      }
    }
  }
  
  return null
}

// Fonction de fallback avec logique am√©lior√©e
export function getProductImageWithFallback(productName: string, category?: string): string | null {
  const directMatch = getProductImage(productName, category)
  
  // Si on a trouv√© null (boissons), retourner null
  if (directMatch === null && IMAGE_MAPPING.hasOwnProperty(productName)) {
    return null
  }
  
  // Si on a trouv√© une image, la retourner
  if (directMatch) return directMatch
  
  // V√©rifier la cat√©gorie avant de faire un fallback
  const normalizedCategory = (category || '').toLowerCase()
  
  // Pas de fallback pour les boissons
  if (normalizedCategory.includes('boisson') || normalizedCategory.includes('drink')) {
    return null
  }
  
  // Fallbacks par ingr√©dients principaux SEULEMENT pour les cat√©gories de nourriture
  const normalized = productName.toLowerCase()
  
  // Fallback uniquement si c'est une cat√©gorie de sushi/maki
  if (category && (normalizedCategory.includes('sushi') || normalizedCategory.includes('maki') || normalizedCategory.includes('california'))) {
    if (normalized.includes('saumon')) {
      if (normalizedCategory.includes('maki')) return 'maki/makis saumon .webp'
      if (normalizedCategory.includes('california')) return 'california/cali saumon avocat .webp'
      return 'sushi nigiri/sushi saumon.webp'
    }
    if (normalized.includes('thon')) {
      if (normalizedCategory.includes('maki')) return 'maki/makis thon.webp'
      return 'sushi nigiri/sushi thon.webp'
    }
  }
  
  if (normalized.includes('crevette') || normalized.includes('gambas')) {
    return 'plat chaud /crevette tempura .webp'
  }
  if (normalized.includes('poulet')) {
    return 'maki/makis poulet cheese .webp'
  }
  
  return null
}

// Statistiques du mapping
export function getMappingStats() {
  const totalProducts = Object.keys(IMAGE_MAPPING).length
  const categories = new Set(
    Object.values(IMAGE_MAPPING).map(path => path.split('/')[0])
  )
  
  return {
    totalMapped: totalProducts,
    categoriesCount: categories.size,
    categories: Array.from(categories),
    coverage: `${totalProducts} produits mapp√©s`
  }
}

// Debug et test des correspondances
export function testImageMapping(productName: string, category?: string) {
  console.group(`üîç Test mapping pour: "${productName}" (${category || 'sans cat√©gorie'})`)
  
  const exactMatch = IMAGE_MAPPING[productName]

  const smartMatch = getProductImage(productName, category)

  const fallbackMatch = getProductImageWithFallback(productName, category)

  console.groupEnd()
  return fallbackMatch
}
